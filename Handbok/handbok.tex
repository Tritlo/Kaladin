%%
%%  Beinagrind fyrir Morpho handbók í LaTeX.
%%  Til að keyra þetta gegnum LaTeX forritið
%%  má t.d. nota pdflatex í cygwin með eftir-
%%  farandi skipun í bash:
%%
%%       pdflatex handbok
%%   eða (virkar líka í cmd):
%%       bash -c 'pdflatex handbok'
%%
\documentclass[12pt,a4paper]{article}
\usepackage[icelandic]{babel}
\usepackage[pdftex]{hyperref}
%\usepackage{makeidx,smplindx,fancyhdr,graphicx,times,multicol,comment}
%\input{/home/tritlo/Dropbox/Latex/header.tex}
\usepackage{listingsutf8}
\usepackage{comment}
\usepackage{times}
\usepackage[T1]{fontenc}
\usepackage[rounded]{syntax}
\setlength{\parskip}{8pt plus 1pt minus 1pt}
\begin{document}
\sloppy
\title{Handbók fyrir Kaladin}
\author{Matthías Páll Gissurarson}
\maketitle

%TODO:
%Bæta við í mállýsingu hvaða token stendur fyrir hvaða tákn.
%Tala um í athugasemdum um hvernig bil virka, þ.e. þau skipta máli
%inn í lykilorðunum, en annars bara eins og í Morpho.
%Tala um í reikniaðgerðum (binop) að þær séu eins og í Morpho.

\begin{abstract}
Kaladin er mál sem reynir að vera eins skýrt og það getur verið, en er
heldur einfalt hvað forritunarmál varða. Kaladin keyrir á Morpho sýndarvélinni.
Kaldin er ólatt skipanamál, en það er bálkmótað hvað föll varðar.
Kaladin styður einungis staðværar breytur.
\end{abstract}

\tableofcontents

\section{Inngangur}
Kaladin er mál sem reynir að vera eins skýrt og það getur verið (verbose) og
keyrir á Morpho sýndarvélinni.

Kaladin má nota frá netinu í gegnum síðuna \url{kaladin.mpg.is},
en til þess að geta keyrt skrár sem málið skilar og þýða án nettengingar,
þá þarf að sækja málið frá github. Málið og handbók þessa má finna á
\url{https://github.com/Tritlo/Kaladin}.

Kaladin þýðist yfir í Morpho smalamál. Til þess að geta notað Kaladin, þá
þarf Morpho að vera uppsett á tölvunni eða \verb|morpho.jar| skráin að vera til
staðar. Morpho má sækja á \url{http://morpho.cs.hi.is/}, en höfundur
Morpho er Snorri Agnarsson.

Kaladin þýðandinn er skrifaður í JavaScript, en til þess að þýða Kaladin skrár
(oftast með \verb|.kal| endingu), þá þarf \verb|Node.js| að vera uppsett á
tölvunni þar sem þýða á skrárnar, en \verb|Node.js| gerir manni
kleyft að keyra JavaScript án vafra. Upplýsingar um \verb|Node.js| og uppsetningu
þess má finna á \url{http://nodejs.org/}.

Kaladin er að mörgu leyti líkt Morpho, og getur kallað á öll föll sem Morpho
býður uppá, án þess að krefjast sérstakrar tiltekningar á því.

Einfalt dæmi um fall er:
\begin{lstlisting}[frame=single,breaklines=true,numbers=left,language=Python]
#Pre : x is int >= 0
#Use : f = fibo(x);
#Post: f is the x-th fibonacci number
The fibo function, whose argument is x, is as follows:
    if x is 0 then
        return 0
    else if x is 1 then
             return 1
         else
           return fibo(x-1) + fibo(x-2)...
which is what we wanted to do.
\end{lstlisting}

en þetta fall má einnig skrifa á hátt sem nýtir sér að segðir hafa
gildi, þ.e.

\begin{lstlisting}[frame=single,breaklines=true,numbers=left,language=Python]
#Pre : x is int >= 0
#Use : f = fib(x);
#Post: f is the x-th fibonacci number
The fib function, whose argument is x, is as follows:
    return if x is less than 2 then x else return fib(x-1) + fib(x-2)..
which is what we wanted to do.
\end{lstlisting}

\section{Notkun og uppsetning}
Til þess að þýða Kaladin skrá er notuð eftirfarandi skipun úr möppunni
þar sem \verb|kaladin.js| er í (hér er ``initial'' notað sem nafnið á skránni
sem þýða á). 
\begin{verbatim}
node kaladin.js initial.kal
\end{verbatim}
en skipunin býr til skjal sem ber heitið ``initial.masm'' í sömu möppu og
skipunin var keyrð úr, sem inniheldur smalamál fyrir Morpho sýndarvélina.

Skránna má svo þýða með Morpho með skipuninni
\begin{verbatim}
java -jar morpho.jar -c initial.masm
\end{verbatim}
og svo keyra með
\begin{verbatim}
java -jar morpho.jar initial
\end{verbatim}

\section{Málfræði}
\subsection{Frumeiningar málsins}
\subsubsection{Athugasemdir}
Athugum að fyrst að mörg lykilorð má skrifa með bæði stórum og litlum upphafsstaf,
og er merkingin sú sama hvora leiðina sem farin er. Bil skipta ekki mál, 
nema hvað að bil í lykilorðum verða að vera eins og bilin eru í lykilorðum í
listanum sem kemur hér á eftir.

Ef táknið \verb|#| kemur fyrir í byrjun línu, þá er allt sem er í línunni
á eftir því tákni hent og ekki tekið til greina.
\subsubsection{Lykilorð}
Lykilorð í Kaladin eru frekar mörg, en sum lykilorðin eru tvö eða fleiri orð
hlið við hlið. Ef svo er, þá verða þau að vera skrifuð
nákvæmlega eins, þ.e. ekki má bæta við auka bili milli orðanna.
 Lykilorðin eru eftirfarandi:
``\verb|function|'',
``\verb|While|'',
``\verb|while|'', 
``\verb|If|'', 
``\verb|if|'',
``\verb|else|'',
``\verb|and|'',
``\verb|or|'',
``\verb|not|'',
``\verb|, whose arguments are|'',
``\verb|, whose argument is|'',
``\verb|, which takes no arguments|'',
``\verb|, is as follows:|'',
%``\verb|and return |'',
``\verb|True|'',
``\verb|true|'',
``\verb|false|'',
``\verb|False|'',
``\verb|Return|'',
``\verb|return|'',
``\verb|We let|''
``\verb|we let|'',
``\verb|Let|'',
``\verb|let|'',
``\verb|then|'',
``\verb|The|'',
``\verb|the|'',
``\verb|Then we do|'',
``\verb|then we do|'',
``\verb|We do|'',
``\verb|we do|'',
``\verb|then we|'',
``\verb|Then we|'',
``\verb|Do|'',
``\verb|do|'',
``\verb|None|'',
``\verb|in|'',
``\verb|be|'',
``\verb|which is what we wanted to do.|'',
``\verb|is less than or equal to|'',
``\verb|is greater than or equal to|'',
``\verb|is less than|'',
``\verb|is greater than|'',
``\verb|is|'',
``\verb|, and|''.

Einnig eru táknin ``\verb|.|'',
``\verb|,| '',
``\verb|;| '',
``\verb|:| '',
``\verb|=|'',
%``\verb|^|'',
``\verb|*|'',
``\verb|/|'',
``\verb|++|'',
``\verb|-|'',
``\verb|+|'',
``\verb|(|'',
``\verb|)|''
frátekin.                      
\subsection{Mállýsing}
\subsubsection{Tákn}
Í mállýsingu eru tákn innan oddklofa millitákn, tákn sem eru innan \verb|'| eru lokatákn,
og tákn sem eru með stórum stöfum eru einnig lokatákn, en merking þeirra er gefin
í eftirfarandi töflu:

\begin{tabular}[c]{| c | c |}
\hline
Regluleg segð sem lýsir lokatákni í forritskóða & Tákn í mállýsingu\\ \hline
\verb|"function"|                                   & \verb|DEF|\\ \hline
\verb|"While"|                                      & \verb|WHILE|\\ \hline
\verb|"while"|                                      & \verb|WHILE|\\ \hline
\verb|"If"|                                         & \verb|IF|\\ \hline
\verb|"if"|                                         & \verb|IF|\\ \hline
\verb|"else"|                                       & \verb|ELSE|\\ \hline
\verb|"and"|                                        & \verb|AND|\\ \hline
\verb|"or"|                                         & \verb|OR|\\ \hline
\verb|"not|                                        & \verb|NOT|\\ \hline
\verb|", whose arguments are"|                      & \verb|ARGSDECL|\\ \hline
\verb|", whose argument is"|                        & \verb|ONEARGDECL|\\ \hline
\verb|", which takes no arguments"|                 & \verb|NOARGSDECL|\\ \hline
\verb|", is as follows:"|                           & \verb|FUNCDECLEND|\\ \hline
\verb|"true"|                                       & \verb|TRUE|\\ \hline
\verb|"True"|                                       & \verb|TRUE|\\ \hline
\verb|"false"|                                      & \verb|FALSE|\\ \hline
\verb|"False"|                                      & \verb|FALSE|\\ \hline
\verb|"Return"|                                     & \verb|RETURN|\\ \hline
\verb|"return"|                                     & \verb|RETURN|\\ \hline
\verb|"We let"|                       & \verb|VAR|\\ \hline
\verb|"we let"|                       & \verb|VAR|\\ \hline
\verb|"Let"|                          & \verb|LET|\\ \hline
\verb|"let"|                          & \verb|LET|\\ \hline
\verb|"then we do"|                   & \verb|TDO|\\ \hline
\verb|"Then we do"|                   & \verb|TDO|\\ \hline
\verb|"we do"|                        & \verb|TDO|\\ \hline
\verb|"We do"|                        & \verb|TDO|\\ \hline
\verb|"Then we"|                      & \verb|TDO|\\ \hline
\verb|"then we"|                      & \verb|TDO|\\ \hline
\end{tabular}


\begin{tabular}[c]{| c | c |}
\hline
Regluleg segð sem lýsir lokatákni í forritskóða & Tákn í mállýsingu\\ \hline
\verb|"then"|                         & \verb|THEN|\\ \hline
\verb|"The"|                          & \verb|THE|\\ \hline
\verb|"the"|                          & \verb|THE|\\ \hline
\verb|"Do"|                          & \verb|DO|\\ \hline
\verb|"do"|                          & \verb|DO|\\ \hline
\verb|"None"|                         & \verb|NONE|\\ \hline
\verb|"in"|                           & \verb|IN|\\ \hline
\verb|"be"|                            & \verb|=|\\ \hline
\verb|"which is what we wanted to do."|                      & \verb|EXPRDELIM|\\ \hline
\verb|"is less than or equal to"|                       & \verb|<=|\\ \hline
\verb|"is greater than or equal to"|                       & \verb|>=|\\ \hline
\verb|"is less than"|                       & \verb|<|\\ \hline
\verb|"is greater than"|                       & \verb|>|\\ \hline
\verb|"is"|                     & \verb|==|\\ \hline
\verb|", and"|                      & \verb|,|\\ \hline
\verb|"("|                     & \verb|(|\\ \hline
\verb|")"|                     & \verb|)|\\ \hline
\verb|"="|                      & \verb|=|\\ \hline
\verb|"*"|                      & \verb|*|\\ \hline
\verb|"/"|                      & \verb|/|\\ \hline
\verb|"++"|                     & \verb|++|\\ \hline
\verb|"-"|                      & \verb|-|\\ \hline
\verb|"+"|                      & \verb|+|\\ \hline
\verb|","|                      & \verb|,|\\ \hline
\verb|\"[^\"]*\"|               & \verb|STRING|\\ \hline
\verb|\'[^\']*\'|               & \verb|STRING|\\ \hline
\verb|[A-Za-z]([A-Za-z0-9])*|   & \verb|NAME|\\ \hline
\verb|[0-9]+("."[0-9]+)?\b|     & \verb|NUMBER|\\ \hline
\verb|\:|                       & \verb|THEN|\\ \hline
\verb|\;|                       & \verb|EXPRDELIM|\\ \hline
\verb|\.|                       & \verb|EXPRDELIM|\\ \hline
\end{tabular}

\subsubsection{BNF mállýsing}
\begin{grammar}
<program> ::= <functions>

<functions> ::= <functions> <function> EXPRDELIM
	 \alt <function> EXPRDELIM

<posArgDecl> ::= NOARGSDECL
          \alt ARGSDECL <names>
          \alt ONEARGDECL NAME

<function> ::= THE NAME DEF <posArgDecl> FUNDECLEND <optdecls> <optexprs>


<names> ::= <names> ',' NAME 
      \alt NAME

<optnames> ::= $\lambda$
        \alt <names>

<args> ::= <args> ',' <expr>
    \alt <expr>


<optargs> ::= $\lambda$
       \alt <args>;

<body> ::= <exprlist>

<decl> ::= VAR NAME "=" <expr> 


<optdecls> ::= $\lambda$
        \alt <decls>

<decls> ::= <decls> <decl> ';'
     \alt <decl> ';'

<exprlist> ::= exprlist ',' <expr>
        | <expr>

<ifrest> ::= ELSE <body>

<ifst> ::= IF expr THEN <body> <ifrest> EXPRDELIM

<whilest> ::= WHILE <expr> THEN <body> EXPRDELIM


<expr> ::= <expr> '+' <expr>             
    \alt <expr> '-' <expr>             
    \alt <expr> '*' <expr>             
    \alt <expr> '/' <expr>             
    \alt <expr> '\^' <expr>             
    \alt '-' <expr>                  
    \alt <expr> '<=' <expr>            
    \alt <expr> '>=' <expr>            
    \alt <expr> '<' <expr>             
    \alt <expr> '>' <expr>             
    \alt <expr> '==' <expr>            
    \alt <expr> "++" <expr>            
    \alt NAME '(' optargs ')'      
    \alt <expr> AND <expr>             
    \alt <expr> OR <expr>              
    \alt NOT <expr>                  
    \alt LET NAME '=' <expr>             
    \alt NAME '=' <expr>             
    \alt NAME                      
    \alt RETURN <expr>               
    \alt NONE                      
    \alt STRING                    
    \alt NUMBER                    
    \alt TRUE                      
    \alt FALSE                     
    \alt '(' <expr> ')'              
    \alt ifst 
    \alt whilest


<exprs> ::= <exprs> <expr> EXPRDELIM
     \alt <expr> EXPRDELIM

<optexprs> ::= $\lambda$
     \alt <exprs>
\end{grammar}
\section{Merking málsins}
\subsection{Gildi}
Gildi í Kaladin geta verið strengir, heiltölur, fleytitölur,
True, False og None.
\subsection{Breytur}
Breytur í kaladin er skilgreindar með því að segja
\verb|We let x be expr|, þar sem að expr er einhver lögleg Kaladin segð.

Hægt er að breyta gildi breytu með því að segja \verb|x = expr| eða
\verb|Let x be expr| eða  \verb|Let x = expr|
\subsection{Merking segða}
\subsubsection{Bókstafssegðir}
\paragraph{None-segð}
\verb|None| segð hefur sömu merkingu og \verb|null| í Morpho.
\paragraph{Heiltölusegð}
Heiltölu segð er segð á forminu \verb|a|, þar sem a má vera hvaða heiltala
sem er, og gildi hennar er heiltalan a. Hún fær sama gildi og samsvarandi
segð í Morpho.
\paragraph{Fleytitölusegð}
Fleytitölu segð er segð á forminu \verb|b|, þar sem b má vera hvaða fleytitala
sem er, og gildi hennar er fleytitalan b. Hún fær sama gildi og samsvarandi
segð í Morpho.
\paragraph{Strengsegð}
Strengsegð er runa stafa, núll eða fleiri, sem afmarkaðir eru með
\verb|"| eða \verb|'|. Hún fær sama gildi og samsvarandi segð í Morpho.
\paragraph{Sanngildissegð}
\verb|True| hefur sömu merkingu og \verb|true| í Morpho.
\verb|False| hefur sömu merkingu og \verb|false| í Morpho.
\subsubsection{return-segð}
Return segðir eru á forminu \verb|Return expr|,
þar sem að expr er einhver lögleg Kaladin segð.

Return segðir geta aðeins komið fyrir inni í fallsskilgreiningum, en
þegar að Return segð kemur fyrir í keyrslu,
þá er reiknað út hvert gildi expr er, og það gildi sett sem skilagildi fallsins,
og fallið látið skila.
\subsubsection{Röksegðir}
Eftirfarandi samanburðar segðir eru í Kaladin,
``\verb|is less than or equal to|'',
``\verb|is greater than or equal to|'',
``\verb|is less than|'',
``\verb|is greater than|'' og
``\verb|is|'',
en þær haga sér eins og
\verb|<=|, \verb|>=|, \verb|<|, \verb|>| og \verb|==| haga sér í Morpho 
(og er í raun bara kall á samsvarandi Morpho fall).

Einnig eru eftirfarandi rökvirkjar,
``\verb|and|'',
``\verb|or|''
 og ``\verb|not|''.
Þeir haga sér eins og rökvirkjarnir $\wedge, \vee$ og $\neg$,
en þeir skammhleypa, þ.e. að þegar þeir koma að gildi sem mundi láta gildi
segðarinnar vera ótvírætt ákvarðarða, þá er hætt að meta gildi segðanna,
og það gildi sem ákvarðað var verður gildi segðarinnar.

Sanngildi segða í Kaladin er eins og sanngildi segða í Morpho, nema í 
Kaladin hefur \verb|None| sama gildi og \verb|null|.
\subsubsection{Kallsegð}
Kall segð í Kaladin er á forminu
``\verb|posVerbose f(x1,...,xn)|''.

Þar sem posVerbose er 
``\verb|We do|'', eða ``\verb|Then we do|'' eða ``\verb|Then we|'' eða ekkert.

þar sem f er fall skilgreint í sömu skrá, eða fall úr Morpho.
Athugið að fjöldi inntaksstærða í fallið verður að sú sama og fallið
er skilgreint fyrir.
\subsubsection{Tvíundaraðgerðir}
Eftirfarandi tvíundaraðgerðir eru í Kaladin:
``\verb|*|'',
``\verb|/|'',
``\verb|-|'',
``\verb|+|'',
``\verb|++|'',
auk þeirra sem koma fyrir í röksegðum.

Tvíundaraðgerðirnar virka eins og þær gera í Morpho, og eru í raun
bara kall á samsvarandi fall í Morpho.
\subsubsection{Einundaraðgerðir}
Í Kaladin eru tvær einundaraðgerðir, en það er \verb|not| virkinn, sem 
breytir sanngildi segðar yfir í öfugt sanngildi.
\verb|-| einundarvirkinn er kall á samsvarandi virkja í Morpho.
\subsubsection{if-segð}
if-segð er á forminu
\verb|If expr then body1 else body2.|
eða \verb|If expr then do body1 else body2.|

þar sem body1 og body2 er listi af segðum aðskilin með kommum
þ.e. \verb|e1,e2,e3, and e4| eða bara
\verb|e1,e2,e3, e4|.

Ef sanngildi \verb|expr| er satt, þá er body1 framkvæmdur, þ.e.
segðirnar í body1 eru gildaðar í þeirri röð sem þær koma fyrir.
Annars er body2 framkvæmdur.
\subsubsection{while-segð}
while-segð er á forminu 
\verb|while expr then body.|
eða \verb|while expr then do body.|

þar sem body er listi af segðum aðskilin með kommum
þ.e. \verb|e1,e2,e3, and e4| eða bara \verb|e1,e2,e3, e4|.

Á meðan sanngildi expr er satt, þá er body framkvæmt, annars er hætt. Athugið að sanngildi
while segðar er alltaf \verb|false|.

\end{document}
