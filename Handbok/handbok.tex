%%
%%  Beinagrind fyrir Morpho handbók í LaTeX.
%%  Til að keyra þetta gegnum LaTeX forritið
%%  má t.d. nota pdflatex í cygwin með eftir-
%%  farandi skipun í bash:
%%
%%       pdflatex handbok
%%   eða (virkar líka í cmd):
%%       bash -c 'pdflatex handbok'
%%
\documentclass[12pt,a4paper]{article}
\usepackage[icelandic]{babel}
\usepackage[pdftex]{hyperref}
%\usepackage{makeidx,smplindx,fancyhdr,graphicx,times,multicol,comment}
%\input{/home/tritlo/Dropbox/Latex/header.tex}
\usepackage{listingsutf8}
\usepackage{times}
\usepackage[T1]{fontenc}
\usepackage[rounded]{syntax}
\newenvironment{repnull}[0]{%
	\begin{stack}
	\\
	\begin{rep}
}{%
	\end{rep}
	\end{stack}
}
\newenvironment{málrit}[1]{%
	\par\noindent\begin{minipage}{\linewidth}\vspace{0.5em}\begin{quote}\noindent%
	\hspace*{-2em}\synt{#1}:\hfill\par%
	\noindent%
	\begin{minipage}{\linewidth}\begin{syntdiag}%
}{%
	\end{syntdiag}\end{minipage}\end{quote}\end{minipage}%
}

\setlength{\parskip}{8pt plus 1pt minus 1pt}
\begin{document}
\sloppy
\title{Handbók fyrir Kaladin}
\author{Matthías Páll Gissurarson}
\maketitle

\begin{abstract}
Kaladin er mál sem reynir að vera eins skýrt og það getur verið, en er
heldur einfalt hvað forritunarmál varða. Kaladin keyrir á Morpho sýndarvélinni.
Kaldin er ``eager'', ``procedural'' mál, en það er bálkmótað hvað föll varðar.
Kaladin styður ekki ``global'' breytur.
\end{abstract}

\tableofcontents

\section{Inngangur}
Kaladin er mál sem reynir að vera eins skýrt og það getur verið (verbose) og
keyrir á Morpho sýndarvélinni.

Kaladin má nota frá netinu í gegnum síðuna \url{kaladin.mpg.is},
en til þess að geta keyrt skrár sem málið skilar og þýða án nettengingar,
þá þarf að sækja málið frá github. Málið og handbók þessa má finna á
\url{https://github.com/Tritlo/Kaladin}.

Kaladin þýðist yfir í Morpho smalamál. Til þess að geta notað Kaladin, þá
þarf Morpho að vera uppsett á tölvunni eða \verb|morpho.jar| skráin að vera til
staðar. Morpho má sækja á \url{http://morpho.cs.hi.is/}, en höfundur
Morpho er Snorri Agnarsson.

Kaladin þýðandinn er skrifaður í JavaScript, en til þess að þýða Kaladin skrár
(oftast með \verb|.kal| endingu), þá þarf \verb|Node.js| að vera uppsett á
tölvunni þar sem þýða á skrárnar, en \verb|Node.js| gerir manni
kleyft að keyra JavaScript án vafra. Upplýsingar um \verb|Node.js| og uppsetningu
þess má finna á \url{http://nodejs.org/}.

Kaladin er að mörgu leyti líkt Morpho, og getur kallað á öll föll sem Morpho
býður uppá, án þess að krefjast sérstakrar tiltekningar á því.

Einfalt dæmi um fall er:
\begin{lstlisting}[frame=single,breaklines=true,numbers=left,language=Python]
#Pre : x is int >= 0
#Use : f = fibo(x);
#Post: f is the x-th fibonacci number
The fibo function, whose argument is x, is as follows:
    if x is 0 then
        return 0
    else if x is 1 then
             return 1
         else
           return fibo(x-1) + fibo(x-2)...
which is what we wanted to do.
\end{lstlisting}

en þetta fall má einnig skrifa á hátt sem nýtir sér að segðir hafa
gildi, þ.e.

\begin{lstlisting}[frame=single,breaklines=true,numbers=left,language=Python]
#Pre : x is int >= 0
#Use : f = fib(x);
#Post: f is the x-th fibonacci number
The fib function, whose argument is x, is as follows:
    return if x is less than 2 then x else return fib(x-1) + fib(x-2)..
which is what we wanted to do.
\end{lstlisting}

\section{Notkun og uppsetning}
Til þess að þýða Kaladin skrá er notuð eftirfarandi skipun úr möppunni
þar sem \verb|kaladin.js| er í (hér er ``initial'' notað sem nafnið á skránni
sem þýða á). 
\begin{verbatim}
node kaladin.js initial.kal
\end{verbatim}
en skipunin býr til skjal sem ber heitið ``initial.masm'' í sömu möppu og
skipunin var keyrð úr, sem inniheldur smalamál fyrir Morpho sýndarvélina.

Skránna má svo þýða með Morpho með skipuninni
\begin{verbatim}
java -jar morpho.jar -c initial.masm
\end{verbatim}
og svo keyra með
\begin{verbatim}
java -jar morpho.jar initial
\end{verbatim}

\section{Málfræði}
\subsection{Frumeiningar málsins}
\subsubsection{Athugasemdir}
Athugum að fyrst að mörg lykilorð má skrifa með bæði stórum og litlum upphafsstaf,
og er merkingin sú sama hvora leiðina sem farin er.
\subsubsection{Lykilorð}
Lykilorð í Kaladin eru frekar mörg, en sum lykilorðin eru tvö eða fleiri orð
hlið við hlið. Lykilorðin eru eftirfarandi:
``\verb|function|'',
``\verb|While|'',
``\verb|while|'', 
``\verb|If|'', 
``\verb|if|'',
``\verb|else|'',
``\verb|and|'',
``\verb|or|'',
``\verb|not|'',
``\verb|, whose arguments are|'',
``\verb|, whose argument is|'',
``\verb|, which takes no arguments|'',
``\verb|, is as follows:|'',
%``\verb|and return |'',
``\verb|True|'',
``\verb|true|'',
``\verb|false|'',
``\verb|False|'',
``\verb|Return|'',
``\verb|return|'',
``\verb|We let|''
``\verb|we let|'',
``\verb|Let|'',
``\verb|let|'',
``\verb|then|'',
``\verb|The|'',
``\verb|the|'',
``\verb|Do|'',
``\verb|do|'',
``\verb|None|'',
``\verb|in|'',
``\verb|be|'',
``\verb|which is what we wanted to do.|'',
``\verb|is less than or equal to|'',
``\verb|is greater than or equal to|'',
``\verb|is less than|'',
``\verb|is greater than|'',
``\verb|is|'',
``\verb|, and|''.

Einnig eru táknin ``\verb|.|'',
``\verb|,| '',
``\verb|;| '',
``\verb|:| '',
``\verb|==|'',
``\verb|=|'',
%``\verb|^|'',
``\verb|*|'',
``\verb|/|'',
``\verb|++|'',
``\verb|-|'',
``\verb|+|'',
``\verb|(|'',
``\verb|)|''
frátekin.                      
\subsection{Mállýsing}
\begin{grammar}
<program> ::= <functions>

<functions> ::= <functions> <function> EXPRDELIM
	 \alt <function> EXPRDELIM

<posArgDecl> ::= NOARGSDECL
          \alt ARGSDECL <names>
          \alt ONEARGDECL NAME

<function> ::= THE NAME DEF <posArgDecl> FUNDECLEND <optdecls> <optexprs>


<names> ::= <names> ',' NAME 
      \alt NAME

<optnames> ::= $\lambda$
        \alt <names>

<args> ::= <args> ',' <expr>
    \alt <expr>


<optargs> ::= $\lambda$
       \alt <args>;

<body> ::= <exprlist>

<decl> ::= VAR NAME "=" <expr> 


<optdecls> ::= $\lambda$
        \alt <decls>

<decls> ::= <decls> <decl> ';'
     \alt <decl> ';'

<exprlist> ::= exprlist ',' <expr>
        | <expr>

<ifrest> ::= ELSE <body>

<ifst> ::= IF expr THEN <body> <ifrest> EXPRDELIM

<whilest> ::= WHILE <expr> THEN <body> EXPRDELIM


<expr> ::= <expr> '+' <expr>             
    \alt <expr> '-' <expr>             
    \alt <expr> '*' <expr>             
    \alt <expr> '/' <expr>             
    \alt <expr> '\^' <expr>             
    \alt '-' <expr>                  
    \alt <expr> '<=' <expr>            
    \alt <expr> '>=' <expr>            
    \alt <expr> '<' <expr>             
    \alt <expr> '>' <expr>             
    \alt <expr> '==' <expr>            
    \alt <expr> "++" <expr>            
    \alt NAME '(' optargs ')'      
    \alt <expr> AND <expr>             
    \alt <expr> OR <expr>              
    \alt NOT <expr>                  
    \alt LET NAME '=' <expr>             
    \alt NAME '=' <expr>             
    \alt NAME                      
    \alt RETURN <expr>               
    \alt NONE                      
    \alt STRING                    
    \alt NUMBER                    
    \alt TRUE                      
    \alt FALSE                     
    \alt '(' <expr> ')'              
    \alt ifst 
    \alt whilest


<exprs> ::= <exprs> <expr> EXPRDELIM
     \alt <expr> EXPRDELIM

<optexprs> ::= $\lambda$
     \alt <exprs>
\end{grammar}
\section{Merking málsins}
\subsection{Gildi}
Gildi í Kaladin geta verið strengir, heiltölur, fleytitölur,
True, False og None.
\subsection{Breytur}
Breytur í kaladin er skilgreindar með því að segja
\verb|We let x be expr|, þar sem að expr er einhver lögleg Kaladin segð.

Hægt er að breyta gildi breytu með því að segja \verb|x = expr| eða
\verb|Let x be expr| eða  \verb|Let x = expr|
\subsection{Merking segða}
\subsubsection{Heiltölusegð}
Heiltölu segð er segð á forminu \verb|a|, þar sem a má vera hvaða heiltala
sem er, og gildi hennar er heiltalan a.
\subsubsection{Fleytitölusegð}
Fleytitölu segð er segð á forminu \verb|b|, þar sem b má vera hvaða fleytitala
sem er, og gildi hennar er fleytitalan b.
\subsubsection{Strengsegð}
Strengsegð er runa stafa, núll eða fleiri, sem afmarkaðir eru með
\verb|"| eða \verb|'|.
%\subsubsection{Stafsegð}
%\subsubsection{Listasegð}
\subsubsection{return-segð}
Return segðir eru á forminu \verb|Return expr|,
þar sem að expr er einhver lögleg Kaladin segð.

Return segðir geta aðeins komið fyrir inni í fallsskilgreiningum, en
þegar að Return segð kemur fyrir í keyrslu,
þá er reiknað út hvert gildi expr er, og það gildi sett sem skilagildi fallsins,
og fallið látið skila.
\subsubsection{Röksegðir}
``\verb|is|'',
``\verb|==|'',
\subsubsection{Kallsegð}
\subsubsection{Tvíundaraðgerðir}
Eftirfarandi tvíundaraðgerðir eru í Kaladin:
%``\verb|^|'',
``\verb|*|'',
``\verb|/|'',
``\verb|-|'',
``\verb|+|'',
``\verb|++|'',
auk þeirra sem koma fyrir í röksegðum.

Þá er gildi \verb|expr1 op expr2|, þar sem op er
``\verb|*|'', ``\verb|/|'', ``\verb|-|'' eða ``\verb|+|''.
 það sama og maður mundi áætla fyrir venjulegan reikning ef expr1 og expr2
 eru tölur (heiltölur eða fleytitölur),
en óskilgreint annars.
``\verb|/|'' virkinn framkvæmir heiltalna deilingu ef bæði expr-in
eru heiltölur, en fleytitöludeilingu annars.

\verb|++| virkinn skeytir saman tveimur strengjum,
þ.e. \verb|'abc' ++ 'bcd'| er sama og \verb|'abcbcd'|.
\subsubsection{Einundaraðgerðir}
Í Kaladin eru tvær einundaraðgerðir, en það er \verb|not| virkinn, sem 
breytir sanngildi segðar yfir í öfugt sanngildi, en einnig er 
\verb|-| virkinn, þ.e. mínus einnig einundarvirki, sem segir að töluna
á eftir virkjanum eigi að túlka sem neikvæða.
\subsubsection{if-segð}
\subsubsection{while-segð}


\section{Ýmis málrit með hjálp syntax pakkans í LaTeX}

Hér eru nokkur málrit skilgreind með hjálp {\tt syntax} pakkans.
Breytið þessu eftir þörfum, eða notið aðrar
aðferðir ef það hentar ykkur betur.

Finna má upplýsingar um {\tt syntax} pakkann
\htmladdnormallinkfoot{á vefnum}{http://www.tug.org/texlive/Contents/live/texmf-dist/doc/latex/mdwtools/syntax.pdf}.

Takið eftir að ráðlegt er að gera einhverjar breytingar hér,
þó ekki væri til annars en að gera textalýsingar á merkingu
einfaldari með tilliti til forgangs ýmissa málfyrirbæra.

\begin{málrit}{id_list}
	\begin{stack}
	
	\\
		\begin{rep} <id> \\ `,' \end{rep}
	\end{stack}
\end{málrit}%

\subsubsection{Forrit}

\begin{málrit}{program}
	\begin{rep}
		<function>
	\end{rep}
\end{málrit}

\subsubsection{Föll}

\begin{málrit}{function}
	<id> `(' <id_list> `)' <body>
\end{málrit}

\subsubsection{Stofnar}
\begin{málrit}{body}
	`{' 
	<decls>
	\begin{repnull} <expr> `;' \end{repnull}
	`}' 
\end{málrit}

\subsubsection{Skilgreiningar}
\begin{málrit}{decls}
	\begin{repnull}
		\begin{stack}
			`var' \begin{rep} <id> \\ `,' \end{rep} `;'
		\\
			`val' \begin{rep} <id> `=' <expr> \\ `,' \end{rep} `;'
		\end{stack}
	\end{repnull}
\end{málrit}

\subsubsection{Segðir}

\begin{málrit}{expr}
	\begin{rep}
		<small_expr>
	\\
		\begin{stack}
			<op>
		\\
			`&&'
		\\
			`||'
		\end{stack}
	\end{rep}
\end{málrit}

\begin{málrit}{small_expr}
	\begin{stack}
		<op> <small_expr>
	\\
		`(' expr `)'
	\\
		<id>
	\\
		<id> `=' <expr>
	\\
		<id> `('
		\begin{repnull}
			<expr>
		\\
			`,'
		\end{repnull}
		`)'
	\\
		`while' expr <body>
	\\
		`return' <expr>
	\\
		`if' expr <body> <if_rest>
	\\
		`['
		\begin{repnull}
			<expr>
		\\
			`,'
		\end{repnull}
		`]'
	\\
		<int>
	\\
		<float>
	\\
		<string>
	\\
		<char>
	\\
		`true'
	\\
		`false'
	\\
		`null'
	\end{stack}
\end{málrit}

\begin{málrit}{if_rest}
	\begin{repnull}
		`elsif' <expr> <body>
	\end{repnull}
	\begin{stack}
	\\
		`else' <body>
	\end{stack}
\end{málrit}

\subsubsection{Annar möguleiki}

\begin{málrit}{expr}
	\begin{stack}
		`return' <expr>
	\\
		<id> `=' <expr>
	\\
		<or_expr>
	\end{stack}
\end{málrit}

\begin{málrit}{or_expr}
	\begin{rep}
		<and_expr>
	\\
		`||'
	\end{rep}
\end{málrit}

\begin{málrit}{and_expr}
	\begin{rep}
		<not_expr>
	\\
		`&&'
	\end{rep}
\end{málrit}

\begin{málrit}{not_expr}
	\begin{repnull}
		`!'
	\end{repnull}
	<binop_expr>
\end{málrit}

\begin{málrit}{binop_expr}
	\begin{rep}
		<small_expr>
	\\
		<op>
	\end{rep}
\end{málrit}

\begin{málrit}{small_expr}
	\begin{stack}
		<op> <small_expr>
	\\
		`(' expr `)'
	\\
		<id>
		\begin{stack}
		\\
		`('
		\begin{repnull}
			<expr>
		\\
			`,'
		\end{repnull}
		`)'
		\end{stack}
	\\
		`while' expr  <body>
	\\
		`if' expr <body> <if_rest>
	\\
		`['
		\begin{repnull}
			<expr>
		\\
			`,'
		\end{repnull}
		`]'
	\\
		<int>
	\\
		<float>
	\\
		<string>
	\\
		<char>
	\\
		`true'
	\\
		`false'
	\\
		`null'
	\end{stack}
\end{málrit}

\end{document}
